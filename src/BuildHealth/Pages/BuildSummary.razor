@page "/buildsummary"

@using BuildHealth.Data.Interfaces
@using BuildHealth.Data.Models

@inject IBuildResultDataService _buildResultService;

<head>
    <style>
        th, td {
            text-align: center;
            border: 1px solid black;
            padding: 5px;
        }
    </style>
</head>

<h3>BuildSummary</h3>

@if (latestAutomation1Result == null || latestAutomation2Result == null || latestAutomation3Result == null)
{
    <p><em>Loading...</em></p>
}
else
{
<table>
    <tr>
        <th></th>
        <th>Automation 1</th>
        <th>Automation 2</th>
        <th>Automation 3</th>
    </tr>
    <tr>
        <td><b>Changelist Cutoff</b></td>
        <td>@latestAutomation1Result.ChangelistCutoff</td>
        <td>@latestAutomation2Result.ChangelistCutoff</td>
        <td>@latestAutomation3Result.ChangelistCutoff</td>
    </tr>
    <tr>
        <td><b>Result</b></td>
        <td>
            <svg height="100" width="100">
                <circle cx="50" cy="50" r="40" stroke="black" stroke-width="3" fill="@latestAutomation1Result.ResultColor()" />
            </svg>
        </td>
        <td>
            <svg height="100" width="100">
                <circle cx="50" cy="50" r="40" stroke="black" stroke-width="3" fill="@latestAutomation2Result.ResultColor()" />
            </svg>
        </td>
        <td>
            <svg height="100" width="100">
                <circle cx="50" cy="50" r="40" stroke="black" stroke-width="3" fill="@latestAutomation3Result.ResultColor()" />
            </svg>
        </td>
    </tr>
    <tr>
        <td><b>Completed At</b></td>
        <td>@latestAutomation1Result.FinishTime</td>
        <td>@latestAutomation2Result.FinishTime</td>
        <td>@latestAutomation3Result.FinishTime</td>
    </tr>
    <tr>
        <td><b>Time Since Completion</b></td>
        <td>@latestAutomation1Result.TimeSinceCompletion().ToString(timespanFormat)</td>
        <td>@latestAutomation2Result.TimeSinceCompletion().ToString(timespanFormat)</td>
        <td>@latestAutomation3Result.TimeSinceCompletion().ToString(timespanFormat)</td>
    </tr>
    <tr>
        <td><b>Processing Time</b></td>
        <td>@latestAutomation1Result.Duration().ToString(timespanFormat)</td>
        <td>@latestAutomation2Result.Duration().ToString(timespanFormat)</td>
        <td>@latestAutomation3Result.Duration().ToString(timespanFormat)</td>
    </tr>
</table>
}


@code {
    BuildResultModel latestAutomation1Result;
    BuildResultModel latestAutomation2Result;
    BuildResultModel latestAutomation3Result;
    string timespanFormat = @"hh' hr 'mm' min 'ss' sec'";

    protected override async Task OnInitializedAsync()
    {
        List<BuildResultModel> buildResult = await _buildResultService.GetBuilds();
        latestAutomation1Result = buildResult[0];
        latestAutomation2Result = buildResult[1];
        latestAutomation3Result = buildResult[2];
    }
}
